<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.zhinanzhen.b.dao.DashboardDAO">
    
    <cache eviction="LRU" flushInterval="120000" readOnly="false" size="100"></cache>

    <select id="getThisMonthVisaExpectAmount" resultType="java.lang.Double">
        select IFNULL(sum(expect_amount),0.00) FROM b_visa bv, tb_adviser tba where DATE_FORMAT(kj_approval_date, '%Y%m') = DATE_FORMAT(CURDATE(), '%Y%m')
        and is_close = 0 and bv.state != 'PENDING' and bv.state != 'WAIT' AND tba.id = bv.adviser_id
        <if test='adviserId != null'>
            AND bv.adviser_id = #{adviserId}
        </if>
        <if test='regionIdList != null'>
            AND tba.region_id IN
            <foreach collection="regionIdList" item="regionIdList" index="index" open="(" close=")" separator=",">
                #{regionIdList}
            </foreach>
        </if>
        ;
    </select>
    <select id="getThisMonthbCommissionOrderExpectAmountSBBTM" resultType="java.lang.Double">
        select IFNULL(sum(expect_amount),0.00) FROM b_commission_order bco , tb_adviser tba  where DATE_FORMAT(kj_approval_date, '%Y%m') = DATE_FORMAT(CURDATE(), '%Y%m')
        and is_close = 0 and bco.state != 'PENDING' and bco.state != 'WAIT' AND tba.id = bco.adviser_id
        <if test='adviserId != null'>
            AND bco.adviser_id = #{adviserId}
        </if>
        <if test='regionIdList != null'>
            AND tba.region_id IN
            <foreach collection="regionIdList" item="regionIdList" index="index" open="(" close=")" separator=",">
                #{regionIdList}
            </foreach>
        </if>
        ;
    </select>
    
    <select id="getVisaUnassignedBonusAmount" resultType="java.lang.Double">
        SELECT IFNULL(sum(bonus),0.00) FROM b_visa WHERE state!='CLOSE' AND bonus_date IS NULL;
    </select>
    <select id="getCommissionOrderUnassignedBonusAmount" resultType="java.lang.Double">
        SELECT IFNULL(sum(bonus),0.00) FROM b_commission_order WHERE state!='CLOSE' AND bonus_date IS NULL;
    </select>
    <select id="getCommissionOrderDZYUnassignedBonusAmount" resultType="java.lang.Double">
        SELECT IFNULL(sum(bonus),0.00) FROM b_commission_order WHERE state!='CLOSE' AND commission_state='DZY' AND bonus_date IS NULL;
    </select>
    <select id="getCommissionOrderSettleUnassignedBonusAmount" resultType="java.lang.Double">
        SELECT IFNULL(sum(co.bonus),0.00) FROM b_commission_order co, b_service_order so WHERE co.service_order_id=so.id AND co.state!='CLOSE' AND so.is_settle=1 AND co.bonus_date IS NULL;
    </select>
    
</mapper>

<div class="modal fade" id="addnewservice1_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document" style="width:700px;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">新增签证服务</h4>
				</div>
				<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
		      <button data-dismiss="alert" class="close close-sm" type="button">
		      <i class="fa fa-times"></i>
		      </button>
		      <strong>Success!</strong> You  just achieved success.
		  	</div>
		  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
	        <button data-dismiss="alert" class="close close-sm" type="button">
	        <i class="fa fa-times"></i>
	        </button>
	        <strong id="error_info"></strong>
	      </div>
				<div class="modal-body">
						<form class="form-inline" style="">
						<input type="hidden" name="user_id" id="user_id" value="0" />													
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">客户姓名<span style="color:red;">*</span></label>
							<label id="b1"></label>
							<label id="b1a"><input type="text" class="form-control small" style="width:150px;" id="b100" placeholder="请输入查询" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,'')" value=""></label>								
						</div>
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">顾问<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="b2"></select>
							<label class="control-label">Mara<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="b3"></select>
							<label class="control-label">文案</label>
							<select class="form-control" style="width:150px;" id="b4"></select>
						</div>
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">服务项目<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="b5" onchange="ajax_service(this.value)">
							<option value="VISA">签证</option>
							<option value="OVST">留学</option>
							</select>
							<select class="form-control" style="width:150px;margin-left:42px;" id="b6"></select>								
						</div>
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">是否已支付<span style="color:red;">*</span></label>
							<input type="radio" name="b7" id="b7a" value="1" /><label for="b7a">是</label>
							<input type="radio" name="b7" id="b7b" value="0" checked="true" style="margin-left:20px;" /><label for="b7b">否</label>
						</div>
						<div id="show_paid" style="width:100%;display:none;">
						<div class="form-group" style="width:100%;">								
								<label class="control-label" style="width:80px;">收款日期</label>
								<input type="text" autocomplete="off" id="b8" class="form-control default-date-picker" style="width:200px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
								<label class="control-label">收款方式</label>
								<select class="form-control" style="width:150px;" id="b9"></select>									
						</div>
						<div class="form-group" style="display:block;line-height:40px;">
								<div class="form-group">
									<label class="control-label" style="width:80px;">总计应收</label>
									$<input type="text" autocomplete="off" id="b10" class="form-control" style="width:100px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">折扣</label>
									$<input type="text" autocomplete="off" id="b11" class="form-control" style="width:100px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">总计收款</label>
									$<input type="text" autocomplete="off" id="b12" class="form-control" style="width:100px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">付款次数</label>
									<select class="form-control" style="width:70px;" id="b13">
									<option value="1"  selected="selected">1</option>
									<option value="2">2</option>
									</select>
								</div>
						</div>
						<div class="form-group" style="display:block;line-height:40px;">
								<div class="form-group">
									<label class="control-label" style="width:80px;">本次收款</label>
									$<input type="text" autocomplete="off" id="b14" class="form-control" style="width:80px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">GST</label>
									$<input type="text" autocomplete="off" id="b15" class="form-control" readonly="true" style="width:80px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">Deduct GST</label>
									$<input type="text" autocomplete="off" id="b16" class="form-control" readonly="true" style="width:80px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">预收业绩</label>
									$<input type="text" autocomplete="off" id="b17" class="form-control" disabled="true" style="width:80px;">
								</div>
						</div>
						</div>
						<div class="form-group" style="width:100%;line-height:40px;">
							<label class="control-label">备注</label>
							<textarea id="b8" class="form-control" style="width:98%"></textarea>
						</div>
						</form>
				</div>
				<div class="modal-footer" style="text-align: center;">
					<button onclick="alert('待实现');" id="upload_receipt" type="button" class="btn btn-danger">上传收款凭证</button>
					<button onclick="addnewService1Save()" type="button" class="btn btn-primary">提交</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
</div>
<div class="modal fade" id="addnewservice2_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document" style="width:700px;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">新增留学服务</h4>
				</div>
				<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
		      <button data-dismiss="alert" class="close close-sm" type="button">
		      <i class="fa fa-times"></i>
		      </button>
		      <strong>Success!</strong> You  just achieved success.
		  	</div>
		  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
	        <button data-dismiss="alert" class="close close-sm" type="button">
	        <i class="fa fa-times"></i>
	        </button>
	        <strong id="error_info"></strong>
	      </div>
				<div class="modal-body">
						<form class="form-inline" style="">
						<input type="hidden" name="user_id" id="user_id" value="0" />
						<input type="hidden" name="schoolid" id="schoolid" value="0" />
						<input type="hidden" name="school_name" id="school_name" value="" />
						<input type="hidden" name="school_subject" id="school_subject" value="" />																				
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">客户姓名<span style="color:red;">*</span></label>
							<label id="c1"></label>
							<label id="c1a"><input type="text" class="form-control small" style="width:150px;" id="c100" placeholder="请输入查询" onKeyUp="value=value.replace(/[^a-zA-Z ]/g,'')" value=""></label>
						</div>
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">服务项目<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="c2" onchange="$('#addnewservice2_id').modal('hide');add_service1(v.user_id,v.user_name);">
							<option value="OVST" selected="selected">留学</option>
							<option value="VISA">签证</option>
							</select>
							<label class="control-label">学校<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="c3" onchange="if (this.value!=''){addnewservice2_ajax_subject();}else{addnewservice2_set_empty();}"></select>
							<label class="control-label">课程<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="c4" onchange="addnewservice2_set_schoolid(this.value)"></select>					
						</div>
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">提前扣佣<span style="color:red;display:none;">*</span></label>
							<input type="radio" name="c5" id="c5a" value="1" /><label for="c5a">是</label>
							<input type="radio" name="c5" id="c5b" value="0" checked="true" style="margin-left:20px;" /><label for="c5b">否</label>
							<input type="checkbox" name="c6" id="c6" value="1" style="margin-left:75px;"><label id="labc6" for="c6">保证金客户</label>
							<label class="control-label" style="width:80px;margin-left:60px;">Subagency<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="c7"></select>	
						</div>
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">顾问<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="c8"></select>								
							<label class="control-label">文案<span style="color:red;">*</span></label>
							<select class="form-control" style="width:150px;" id="c9"></select>
						</div>
						<div id="show_deposit_user" style="width:100%;display:none;">
						<div class="form-group" style="width:100%;height:40px;">
							<label class="control-label" style="width:80px;">保证金是否已支付<span style="color:red;">*</span></label>
							<input type="radio" name="c10" id="c10a" value="true" checked="true" /><label for="c10a">是</label>
							<input type="radio" name="c10" id="c10b" value="false" style="margin-left:20px;" /><label for="c10b">否</label>
						</div>
						<div class="form-group" style="width:100%;">								
								<label class="control-label" style="width:80px;">收款日期</label>
								<input type="text" autocomplete="off" id="c11" class="form-control default-date-picker" style="width:200px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
								<label class="control-label">收款方式</label>
								<select class="form-control" style="width:150px;" id="c12"></select>									
						</div>
						<div class="form-group" style="display:block;line-height:40px;">
								<div class="form-group">
									<label class="control-label" style="width:80px;">总计应收</label>
									$<input type="text" autocomplete="off" id="c13" class="form-control" style="width:100px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">折扣</label>
									$<input type="text" autocomplete="off" id="c14" class="form-control" style="width:100px;">
								</div>
								<div class="form-group" style="margin-left:10px;">
									<label class="control-label">总计收款</label>
									$<input type="text" autocomplete="off" id="c15" class="form-control" style="width:100px;">
								</div>									
						</div>							
						</div>
						<div class="form-group" style="width:100%;line-height:40px;">
							<label class="control-label">备注</label>
							<textarea id="b8" class="form-control" style="width:98%"></textarea>
						</div>
						</form>
				</div>
				<div class="modal-footer" style="text-align: center;">
					<button onclick="addnewService2Save()" type="button" class="btn btn-primary">提交</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
</div>
<div class="modal fade" id="addnewservice2_add_schoolsubject_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index:999999;">
			<div class="modal-dialog" role="document">
				<div class="modal-content" style="background:#efefef;">
					<div class="modal-header" style="background:#72d0eb;">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">添加课程</h4>
					</div>
					<div class="modal-body" style="background:#efefef;">
							<form class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-2 control-label">课程名程<span style="color:red;">*</span></label>
								<div class="col-sm-8">
									<input type="text" id="schoolsubject_name" class="form-control" placeholder="" />
								</div>
							</div>
							</form>
					</div>
					<div class="modal-footer" style="background:#efefef;">
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="addnewservice2_ajax_subject();">取消</button>
						<button onclick="addnewservice2_schoolSubjectSave()" type="button" class="btn btn-primary">确认</button>
					</div>
				</div>
			</div>
		</div>
<script>
function add_service1(id,name)
{
		$("#addnewservice1_id #user_id").val('0');
		if (id != '')
		{ 	
				$("#addnewservice1_id #user_id").val(id);
				$('#addnewservice1_id #b1').show();
				$('#addnewservice1_id #b1').html(name);
				$('#addnewservice1_id #b1a').hide();      				
				v.user_id = id;
				v.user_name = name;
		}else
		{
				$("#addnewservice1_id #b100").val('');
				$('#addnewservice1_id #b1').hide();
				$('#addnewservice1_id #b1').html('');
				$('#addnewservice1_id #b1a').show();
		}
		$('#addnewservice1_id #show_paid').hide();
		$('#addnewservice1_id #upload_receipt').hide();		
		$("#addnewservice1_id #b5 option:first").prop('selected', 'selected');
		$("#addnewservice1_id #b7b").attr('checked','checked');
		$("#addnewservice1_id #b8").val('');
		$("#addnewservice1_id #b9 option:first").prop('selected', 'selected'); 
		$("#addnewservice1_id #b10").val('');
		$("#addnewservice1_id #b11").val('');
		$("#addnewservice1_id #b12").val('');
		$("#addnewservice1_id #b13 option:first").prop('selected', 'selected'); 
		$("#addnewservice1_id #b14").val('');
		$("#addnewservice1_id #b15").val('');
		$("#addnewservice1_id #b16").val('');
		$("#addnewservice1_id #b17").val('');
		v.addnewservice1_bind = 1;//签证表单：绑定下拉框选项
		$('#addnewservice1_id').modal('show');      		
		ajax_service('VISA');
}

function add_service2(id,name)
{
		//留学服务
		$("#addnewservice2_id #user_id").val('0');
		if (id != '')
		{ 	
				$("#addnewservice2_id #user_id").val(id);
				$('#addnewservice2_id #c1').show();
				$('#addnewservice2_id #c1').html(name);
				$('#addnewservice2_id #c1a').hide();      				
				v.user_id = id;
				v.user_name = name;
		}else
		{
				$("#addnewservice2_id #c100").val('');
				$('#addnewservice2_id #c1').hide();
				$('#addnewservice2_id #c1').html('');
				$('#addnewservice2_id #c1a').show();
		}
		$("#addnewservice2_id #labc6");
		var school_subject = $("#addnewservice2_id #c4");
		school_subject.append("<option value=''>请选择</option>");    		
		$("#addnewservice2_id #c2 option:first").prop('selected', 'selected');
		v.addnewservice2_bind = 1;//留学表单：绑定下拉框选项    		
		$('#addnewservice2_id').modal('show');      		
}

$('#addnewservice1_id :radio').live('click', function (e) {
		if ($(this).val() == '1')
		{
				$('#addnewservice1_id #show_paid').show();      				
				$('#addnewservice1_id #upload_receipt').show();
		}else
		{
				$('#addnewservice1_id #show_paid').hide();
				$('#addnewservice1_id #upload_receipt').hide();
		}				
});

$('#addnewservice2_id :checkbox').live('click', function (e) {
		if($('#addnewservice2_id #c6').is(':checked'))
		{
				$('#addnewservice2_id #show_deposit_user').show();      				
		}else
		{
				$('#addnewservice2_id #show_deposit_user').hide();
		}				
});

/*$('#addnewservice2_id #labc6').live('click', function (e) {
		if (!c6checked)
		{
				$('#addnewservice2_id #c6').prop("checked",'checked');
				$('#addnewservice2_id #show_deposit_user').show();
				c6checked = 1;
		}else
		{
				$('#addnewservice2_id #c6').prop("checked",false);
				$('#addnewservice2_id #show_deposit_user').hide();
				c6checked = 0;
		}
});*/

function ajax_service(va)
{
		if (va == 'VISA')
		{
				//签证服务
				var service_code = $("#addnewservice1_id #b6");
				service_code.find("option:selected").text("");
				service_code.empty();
				service_code.append("<option value=''>请选择</option>");
				$.ajax({
          url: 'service/list',
          type: 'GET',
          dataType: 'json'
        }).done(function(response) {
        	response = response.data;
        	for (var item in response)
        	{
        			if (!response[item].code == '')
        			{
		        			service_code.append("<option value='"+response[item].id+"'>"+response[item].code+"</option>");		
        			}
        	}	        	     	
        });
  	}else if (va == 'OVST')
  	{
  			//留学服务
  			$('#addnewservice1_id').modal('hide'); 
  			add_service2(v.user_id,v.user_name);
  	}
}

function addnewservice2_ajax_subject()
{
	var school_subject = $("#addnewservice2_id #c4");
	var school_name = $("#addnewservice2_id #c3").find("option:selected").text();			
	if (school_name != '请选择学校' || $("#addnewservice2_id #school_name").val() != '')
	{
			schoolid = $("#addnewservice2_id #schoolid").val();
			schoolSubject = $("#addnewservice2_id #school_subject").val();
			if (school_name == '请选择学校') school_name = $("#addnewservice2_id #school_name").val();
			v.school_name = school_name;						
			school_subject.find("option:selected").text("");
			school_subject.empty();
			school_subject.append("<option value=''>请选择</option>");
	    $.ajax({
        url: 'school/list?name='+school_name,
        type: 'GET',
        dataType: 'json'
      }).done(function(response) {
      	response = response.data;
      	for (var item in response)
      	{
      			if (!response[item].subject == '')
      			{
	        			school_subject.append("<option value='"+response[item].id+"'>"+response[item].subject+"</option>");		
	        			v.country = response[item].country;
      			}
      	}
      	school_subject.append("<option value='-1'>我要添加</option>");
      	if(schoolSubject != '') school_subject.val(schoolid);		        	
      });
	}else
	{
			school_subject.find("option:selected").text("");
			school_subject.empty();
	}
}

function addnewservice2_set_empty()
{
	var school_subject = $("#addnewservice2_id #c4");
	school_subject.find("option:selected").text("");
	school_subject.empty();
	school_subject.append("<option value=''>请选择</option>");
}

function addnewservice2_set_schoolid(id)
{
	if(id > 0)
	{
		$("#addnewservice2_id #schoolid").val(id);
	}else if(id == '')
	{
		$("#addnewservice2_id #schoolid").val(0);
	}else if(id == -1)
	{
		$('#addnewservice2_add_schoolsubject_id').modal('show');
	}
}

function addnewservice2_schoolSubjectSave()
{
	var school_subject = $("#addnewservice2_add_schoolsubject_id #schoolsubject_name").val();
	if (school_subject != '')
	{
			var str_url = "school/add";
			$.post(str_url, { id: 0, name: v.school_name, subject: school_subject, country: v.country},
	   	function(data){
	   			if (data.code == 0)
	   			{
	   					//添加成功
	   					$('#addnewservice2_add_schoolsubject_id').modal('hide');
	   					addnewservice2_ajax_subject();
	   			}
	   			//console.log(data);
	   	});
	}
}

function addnewService1Save()
{
		var jqInputs = $('input',$("#addnewservice1_id"));
    var jqSelect = $('select',$("#addnewservice1_id"));
    var jqTextarea = $('textarea',$("#addnewservice1_id"));         	
    
    var check_result = 0;
    if (jqSelect[0].value != '0' && jqSelect[1].value != '0' && jqSelect[2].value != '0' && jqSelect[4].value != '0')
    {
    		check_result = true;
    }else
    {
    		$('#addnewservice1_id #alert_error').css('marginLeft','30%');
    		$('#addnewservice1_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
        $("#addnewservice1_id #error_info").html('提示：红色字段必须填写或选择！');
    		return false;
    }
    
    if (check_result)
    {            	            	            	                             
       	var str_url = "serviceOrder/add";
       	var json = {};
       	json['adviserId'] = jqSelect[0].value;
       	json['maraId'] = jqSelect[1].value;
       	json['officialId'] = jqSelect[2].value;
       	json['type'] = jqSelect[3].value;
       	json['serviceId'] = jqSelect[4].value;
       	json['paid'] = $("input[name='b7']:checked").val();
       	json['userId'] = $("#user_id").val();
       	json['remarks'] = jqTextarea[0].value;
       	json['isPay'] = false;
       	if (json['paid'] == 1)
       	{
       			var d1 = 0;          		
        		if (jqInputs[3].value != '')
        		{
	          		var arr_d = jqInputs[3].value.split("/");
	          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
	              var date = new Date(str_d);
	              d1 = date.getTime();
          	}
          	json['receiveDate'] = d1;
          	json['receiveTypeId'] = jqSelect[5].value;
          	json['receivable'] = jqInputs[4].value;
          	json['discount'] = jqInputs[5].value;
          	json['received'] = jqInputs[6].value;
          	json['paymentTimes'] = jqSelect[6].value;
          	json['amount'] = jqInputs[7].value;
          	json['gst'] = jqInputs[8].value;
          	json['deductGst'] = jqInputs[9].value;
          	json['bonus'] = jqInputs[10].value;
          	json['isPay'] = true;
       	}
       	
       	$.post(str_url, json,
		   	function(data){
		   			if (data.code == 0)
		   			{
		   					$('#addnewservice1_id #alert_success').addClass('alert-success').show().delay(1500).fadeOut();
		   					//$('#addnewservice1_id').modal('hide');
		   					setTimeout(function(){window.location.href = "serviceorder-list.html";}, 2000);
		   			}else
		   			{
		   					$('#addnewservice1_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
          			$("#error_info").html(data.message);
	        			return false;
		   			}
		   	});       		            
    }
}

function addnewService2Save()
{
		var jqInputs = $('input',$("#addnewservice2_id"));
    var jqSelect = $('select',$("#addnewservice2_id"));
    var jqTextarea = $('textarea',$("#addnewservice2_id"));
    
    var check_result = 0;
    if (jqSelect[0].value != '0' && jqSelect[1].value != '0' && jqSelect[2].value != '0' && jqSelect[3].value != '0' && jqSelect[4].value != '0' && jqSelect[5].value != '0' && jqInputs[0].value != '0')
    {
    		check_result = true;
    }else
    {
    		$('#addnewservice2_id #alert_error').css('marginLeft','30%');
    		$('#addnewservice2_id #alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
        $("#addnewservice2_id #error_info").html('提示：红色字段必须填写或选择！');
    		return false;
    }
    
    if (check_result)
    {            	            	            	                             
       	var str_url = "serviceOrder/add";
       	var json = {};
       	             	
       	json['type'] = jqSelect[0].value;
       	json['schoolId'] = jqSelect[2].value;
       	json['isSettle'] = false;
       	if ($("input[name='c5']:checked").val() == 1) json['isSettle'] = true;
       	if ($('#c6').is(':checked'))
       	{
       			json['isDepositUser'] = $("input[name='c6']:checked").val();
       	}else
       	{
       			json['isDepositUser'] = false;
       	}
       	json['subagencyId'] = jqSelect[3].value;
       	json['adviserId'] = jqSelect[4].value;
       	json['officialId'] = jqSelect[5].value;             	
       	json['userId'] = $("#user_id1").val();
       	json['remarks'] = jqTextarea[0].value;
       	json['isPay'] = false;             	
       	if (json['isDepositUser'])
       	{
       			json['isPay'] = $("input[name='c10']:checked").val();
       			var d1 = 0;          		
        		if (jqInputs[10].value != '')
        		{
	          		var arr_d = jqInputs[10].value.split("/");
	          		var str_d = arr_d[2]+'-'+arr_d[1]+'-'+arr_d[0];
	              var date = new Date(str_d);
	              d1 = date.getTime();
          	}
          	json['receiveDate'] = d1;
          	json['receiveTypeId'] = jqSelect[6].value;
          	json['receivable'] = jqInputs[11].value;
          	json['discount'] = jqInputs[12].value;
          	json['received'] = jqInputs[13].value;		            			            	
       	}
       	//预设空值
       	json['serviceId'] = 0;
       	json['maraId'] = 0;
       	//console.log(json);
       	
       	$.post(str_url, json,
		   	function(data){
		   			if (data.code == 0)
		   			{
		   					$('#alert_success').css('marginLeft','30%');
		   					$('#alert_success').addClass('alert-success').show().delay(1500).fadeOut();
		   					$('#addservice_id').modal('hide');
		   					setTimeout(function(){window.location.href = "serviceorder-list.html";}, 2000);					   					
		   			}else
		   			{
		   					$('#alert_error').addClass('alert-danger').show().delay(3000).fadeOut();
          			$("#error_info").html(data.message);
	        			return false;
		   			}
		   	});
       		            
    }
}

v.$watch('addnewservice1_bind', function(obj) {
		$('.default-date-picker').datepicker({   				
	        format: 'dd/mm/yyyy'
	  });
	  $('.default-date-picker1').datepicker({   				
	        format: 'dd/mm/yyyy'			        
	  });
	  //查询客户
	  var user = $("#addnewservice1_id #b100");
	  user.autocompleter({
    	highlightMatches: true,
    	limit: 10,
    	cache: false,
    	customValue: 'name',
    	customLabel: 'name',
    	source: 'user/list?authNickname=&phone=&pageNum=0',
    	combine: function(params) {
    		return {
	        name: params.query,
	        pageSize: params.limit
	      };
    	},
    	callback: function(value, index, object) {
    		$('#addnewservice1_id #user_id').val(object.id);	    		
    	},
    	minLength: 1						    	
    });    
	  //绑定顾问
	  var obj_adviserId = $("#addnewservice1_id #b2");
	  //obj_adviserId.empty();
    obj_adviserId.append("<option value='0'>请选择</option>");
    $.ajax({
      url: 'adviser/list?pageNum=0&pageSize=100000',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			if (v.adviser_id == 'null')
    			{
    					obj_adviserId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    			}else
    			{
    					if (v.adviser_id == response[item].id) obj_adviserId.append("<option value='"+response[item].id+"' selected='true'>"+response[item].name+"</option>");    					
    			}
    	}
    	obj_adviserId.val(v.adviser_id);   
    });
    //绑定Mara列表			    
    var obj_mara = $("#addnewservice1_id #b3");
    //obj_mara.empty();
    obj_mara.append("<option value='0'>请选择</option>");
    $.ajax({
      url: 'mara/list?pageNum=0&pageSize=10',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			obj_mara.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    	}
    	obj_mara.val(0);	        	
    });
    //绑定文案列表			    
    var obj_officialId = $("#addnewservice1_id #b4");
    //obj_officialId.empty();
    obj_officialId.append("<option value='0'>请选择</option>");
    $.ajax({
      url: 'official/list?pageNum=0&pageSize=10',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			obj_officialId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    	}
    	obj_officialId.val(0);	        	
    });
    //绑定收款方式
    var receive_type = $("#addnewservice1_id #b9");    
    $.ajax({
      url: 'receiveType/list?state=ENABLED',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			receive_type.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    	}	        	 	    
    });
    //计算GST相关金额
    $("#addnewservice1_id #b14").keyup(function(){
    	var fee = $("#addnewservice1_id #b14").val();
    	var gst = (fee/11).toFixed(2);
    	$("#addnewservice1_id #b15").val(gst);
    	var deduct_gst = (fee-gst).toFixed(2);
    	$("#addnewservice1_id #b16").val(deduct_gst);	        	
		});
});

v.$watch('addnewservice2_bind', function(obj) {
		$('.default-date-picker').datepicker({   				
	        format: 'dd/mm/yyyy'
	  });
	  $('.default-date-picker1').datepicker({   				
	        format: 'dd/mm/yyyy'			        
	  });
	  //查询客户
	  var user = $("#addnewservice2_id #c100");
	  user.autocompleter({
    	highlightMatches: true,
    	limit: 10,
    	cache: false,
    	customValue: 'name',
    	customLabel: 'name',
    	source: 'user/list?authNickname=&phone=&pageNum=0',
    	combine: function(params) {
    		return {
	        name: params.query,
	        pageSize: params.limit
	      };
    	},
    	callback: function(value, index, object) {
    		$('#addnewservice2_id #user_id').val(object.id);	    		
    	},
    	minLength: 1						    	
    });
	  //绑定学校信息
    var school_name = $("#addnewservice2_id #c3");
    school_name.append("<option value=''>请选择学校</option>");
    $.ajax({
      url: 'school/listSchool?name=',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;	        	    	
    	for (var item in response)
    	{
    			school_name.append("<option value='"+response[item].name+"'>"+response[item].name+"</option>");
    	}	
    	school_name.val('');
    });
    //绑定Subagency列表
    var obj_subagencyId = $("#addnewservice2_id #c7");	
    $.ajax({
      url: 'subagency/list',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			obj_subagencyId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    	}
    	obj_subagencyId.val('');   
    });
	  //绑定顾问
	  var obj_adviserId = $("#addnewservice2_id #c8");
    obj_adviserId.append("<option value='0'>请选择</option>");
    $.ajax({
      url: 'adviser/list?pageNum=0&pageSize=100000',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			if (v.adviser_id == 'null')
    			{
    					obj_adviserId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    			}else
    			{
    					if (v.adviser_id == response[item].id) obj_adviserId.append("<option value='"+response[item].id+"' selected='true'>"+response[item].name+"</option>");    					
    			}
    	}
    	obj_adviserId.val(v.adviser_id);   
    });    
    //绑定文案列表			    
    var obj_officialId = $("#addnewservice2_id #c9");
    obj_officialId.append("<option value='0'>请选择</option>");
    $.ajax({
      url: 'official/list?pageNum=0&pageSize=10',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			obj_officialId.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    	}
    	obj_officialId.val(0);	        	
    });
    //绑定收款方式
    var receive_type = $("#addnewservice2_id #c12");
    $.ajax({
      url: 'receiveType/list?state=ENABLED',
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {
    	response = response.data;
    	for (var item in response)
    	{
    			receive_type.append("<option value='"+response[item].id+"'>"+response[item].name+"</option>");
    	}	        	 	    
    });
});
</script>
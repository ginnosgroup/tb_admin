<meta charset="utf-8"/>
<div id="app_sub">
<div class="modal fade" id="show_addnewservice1_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document" style="width:700px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">服务详情页</h4>
					</div>
					<div class="modal-body">
							<form class="form-inline" style="">
							<input type="hidden" name="user_id" id="user_id" value="0" />
							<input type="hidden" name="service_id" id="service_id" value="0" />
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>客户姓名：</strong></label>								
								<label id="b1"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>顾问：</strong></label>
								<label id="b2" style="width:100px;"></label>
								<label class="control-label"><strong>Mara：</label>
								<label id="b3" style="width:100px;"></label>
								<label class="control-label"><strong>文案：</label>
								<label id="b4" style="width:100px;"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>服务项目：</strong></label>
								<label id="b5">签证</label> - 
								<label id="b6"></label>						
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>是否已支付：</strong></label>
								<label id="b7"></label>
							</div>
							<div v-if="ap_list==='GW' || ap_list==='null'" id="show_paid" style="width:100%;display:none;">
							<hr/>
							<div class="form-group" style="width:100%;">								
									<label class="control-label" style="width:80px;"><strong>收款日期：</strong></label>
									<label id="b8" style="width:100px;"></label>
									<label class="control-label"><strong>收款方式：</strong></label>
									<label id="b9" style="width:150px;"></label>
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
									<div class="form-group">
										<label class="control-label" style="width:80px;"><strong>总计应收：</strong></label>
										$<label id="b10" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>折扣：</strong></label>
										$<label id="b11" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>总计收款：</strong></label>
										$<label id="b12" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>付款次数：</strong></label>
										<label id="b13"></label>
									</div>
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
									<div class="form-group">
										<label class="control-label" style="width:80px;"><strong>本次收款：</strong></label>
										$<label id="b14" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>GST：</strong></label>
										$<label id="b15" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>Deduct GST：</strong></label>
										$<label id="b16" style="width:65px;"></label>
									</div>
									<div class="form-group" style="">
										<label class="control-label"><strong>预收业绩</strong></label>
										$<label id="b17" style="width:50px;"></label>
									</div>
							</div>
							</div>
							<hr/>
							<div class="form-group" style="width:100%;line-height:40px;">
								<label class="control-label"><strong>备注：</strong></label>
								<label id="b18"></label>
							</div>
							<div>
									<div style="text-align: center;">流程进度条...待实现...</div>
							</div>
							<div v-if="ap_list==='WA'">
									<hr/>
									<div class="form-group" style="width:100%;line-height:40px;">
										<label class="control-label"><strong>状态：</strong></label>
										<select class="form-control" style="width:150px;" id="b19" onchange="if(this.value=='CLOSE'){$('#upload_certificate').show();$('#close_remarks').show();}else{$('#upload_certificate').hide();$('#close_remarks').hide();}">
										<option value="PENDING">未审核</option>
										<option value="REVIEW">资料审核中</option>
										<option value="FINISH">资料已审核</option>
										<option value="APPLY">已提交申请</option>
										<option value="COMPLETE">申请成功</option>
										<option value="CLOSE">已关闭</option>
										</select>
									</div>
									<div id="close_remarks" class="form-group" style="display:none;width:100%;line-height:40px;">
										<label class="control-label"><strong>备注：<span style="color:red;">(此功能接口待实现)</span></strong></label>
										<textarea id="b101" class="form-control" style="width:98%"></textarea>							
									</div>
							</div>							
							</form>
					</div>
					<div class="modal-footer" style="text-align: center;">
							<dle v-if="ap_list==='GW'">
									<dle v-if="flowstate_gw==='REVIEW'">
									<button onclick="flowstep('PENDING',1)" type="button" class="btn btn-default">撤回</button>
									</dle>
							</dle>
							<dle v-if="ap_list==='WA'">
									<dle v-if="flowstate_gw==='REVIEW'">
											<button onclick="flowstep($('#b19').val(),1);" type="button" class="btn btn-primary">提交</button>											
									</dle>
									<dle v-if="flowstate_wa==='REVIEW'">
											<dle v-if="flowstate_ma!=='FINISH'">
											<button onclick="flowstep('WAIT',1)" type="button" class="btn btn-default">提交Mara审核</button>
											<button onclick="flowstep('PENDING',0)" type="button" class="btn btn-default">驳回</button>
											</dle>
									</dle>
									<dle v-if="flowstate_ma==='WAIT' || flowstate_wa==='WAIT'">
											<button onclick="flowstep('REVIEW',1)" type="button" class="btn btn-default">撤回</button>
									</dle>
									<dle v-if="flowstate_ma==='FINISH' || flowstate_wa==='APPLY' || flowstate_wa==='COMPLETE'">
									<button onclick="alert('待实现');" id="upload_certificate" type="button" class="btn btn-danger" style="display:none;">上传签证凭证</button>
									<button onclick="flowstep($('#b19').val(),1);" type="button" class="btn btn-primary">提交</button>
									</dle>
							</dle>
							<dle v-if="ap_list==='MA'">
									<dle v-if="flowstate_ma==='WAIT' || flowstate_wa==='WAIT'">
											<button onclick="flowstep('FINISH',1)" type="button" class="btn btn-primary">通过</button>
											<button onclick="flowstep('REVIEW',0)" type="button" class="btn btn-default">驳回</button>
									</dle>
							</dle>						
							<button onclick="" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
</div>

<div class="modal fade" id="show_addnewservice2_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document" style="width:700px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">服务详情页</h4>
					</div>
					<div class="modal-body">
							<form class="form-inline" style="">																											
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>客户姓名：</strong></label>								
								<label id="c1"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>服务项目：</strong></label>
								<label id="c2" style="width:100px;">留学</strong></label>
								<label class="control-label"><strong>学校：</strong></label>
								<label id="c3" style="width:150px;"></label>
								<label class="control-label"><strong>课程：</strong></label>
								<label id="c4"></label>			
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>提前扣佣：</strong></label>
								<label id="c5" style="width:50px;"></label>
								<label><strong>保证金客户：</strong></label>
								<label id="c6" style="width:50px;"></label>
								<label class="control-label" style="width:80px;margin-left:60px;"><strong>Subagency：</strong></label>
								<label id="c7"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>顾问：</strong></label>
								<label id="c8" style="width:100px;"></label>
								<label class="control-label"><strong>文案：</strong></label>
								<label id="c9" style="width:100px;"></label>
							</div>
							<div id="show_deposit_user" style="width:100%;display:none;">
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:120px;"><strong>保证金是否已支付：</strong></label>
								<label id="c10" style="width:100px;"></label>
							</div>
							<div class="form-group" style="width:100%;">								
									<label class="control-label" style="width:80px;"><strong>收款日期：</strong></label>
									<label id="c11" style="width:100px;"></label>
									<label class="control-label"><strong>收款方式：</strong></label>
									<label id="c12"></label>
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
									<div class="form-group">
										<label class="control-label" style="width:80px;"><strong>总计应收：</strong></label>
										$<label id="c13" style="width:100px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>折扣：</strong></label>
										$<label id="c14" style="width:100px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>总计收款：</strong></label>
										$<label id="c15"></label>
									</div>									
							</div>							
							</div>
							<hr/>
							<div class="form-group" style="width:100%;line-height:40px;">
									<label class="control-label"><strong>备注：</strong></label>
									<label id="c16"></label>									
							</div>
							<div id="show_reqcommission" style="width:100%;margin-bottom:10px;display:none;">
									<hr/>
									<div class="form-group" style="width:100%;line-height:40px;">
											<label class="control-label"><strong>佣金信息</strong></label><label style="color:red;">(此表单暂时无法填写，因佣金接口在调整)</label>																	
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">StudentID<span style="color:red;">*</span></label>
											<input type="text" autocomplete="off" id="c20" class="form-control" style="width:200px;" placeholder="请输入学生ID">							
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">Installment：<span style="color:red;">*</span></label>
											<select class="form-control" style="width:70px;" id="c21">
											<option value="1">1</option>
											<option value="2">2</option>
											</select>
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">开课日期</label>
											<input type="text" autocomplete="off" id="c22" class="form-control default-date-picker" style="width:150px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
											<label class="control-label" style="margin-left:40px;">结束日期</label>
											<input type="text" autocomplete="off" id="c23" class="form-control default-date-picker" style="width:150px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">								
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">Installment 1<br/>Due Date<span style="color:red;">*</span></label>
											<input type="text" autocomplete="off" id="c24" class="form-control" style="width:200px;" placeholder="请选择日期">							
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">学费总金额<br/>Tuition Fee<span style="color:red;">*</span></label>
											<input type="text" autocomplete="off" id="c25" class="form-control" style="width:200px;" placeholder="">							
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">每学期学费金额<br/>Per Term Tuition Fee<span style="color:red;">*</span></label>
											<input type="text" autocomplete="off" id="c26" class="form-control" style="width:200px;" placeholder="">							
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">								
											<label class="control-label" style="width:150px;">本次收款日期<span style="color:red;">*</span></label>
											<input type="text" autocomplete="off" id="c27" class="form-control default-date-picker" style="width:200px;" placeholder="请选择日期" data-date-format="yyyy-mm-dd">
											<label class="control-label">收款方式<span style="color:red;">*</span></label>
											<select class="form-control" style="width:150px;" id="c28"></select>									
									</div>
									<div class="form-group" style="display:block;margin-top:10px;">
											<div class="form-group">
												<label class="control-label" style="width:150px;">本次应收学费<span style="color:red;">*</span></label>
												$<input type="text" autocomplete="off" id="c29" class="form-control" style="width:100px;">
											</div>
											<div class="form-group" style="margin-left:10px;">
												<label class="control-label">折扣</label>
												$<input type="text" autocomplete="off" id="c30" class="form-control" style="width:100px;">
											</div>
											<div class="form-group" style="margin-left:10px;">
												<label class="control-label">本次收款</label>
												$<input type="text" autocomplete="off" id="c31" class="form-control" style="width:100px;">
											</div>
											<div class="form-group" style="margin-top:10px;margin-left:150px;">
												<label class="control-label">预收业绩</label>
												$<input type="text" autocomplete="off" disabled="disabled" id="c32" class="form-control" style="width:100px;">
											</div>									
									</div>
									<div class="form-group" style="width:100%;margin-top:10px;">
											<label class="control-label">备注</label>
											<textarea id="c33" class="form-control" style="width:98%"></textarea>
									</div>
							</div>
							<div>
									<div style="text-align: center;">流程进度条...待实现...</div>
							</div>
							<div v-if="ap_list==='WA'">
									<hr/>
									<div class="form-group" style="width:100%;line-height:40px;">
										<label class="control-label"><strong>状态：</strong></label>
										<select class="form-control" id="c200" onchange="if(this.value=='PAID'){$('#upload_certificate1').show();}else{$('#upload_certificate1').hide();}if(this.value=='CLOSE'){$('#close_remarks1').show();}else{$('#close_remarks1').hide();}">
										<option value="PENDING">未审核</option>
										<option value="REVIEW">资料审核中</option>
										<option value="FINISH">资料已审核</option>
										<option value="APPLY">已提交申请</option>
										<option value="COMPLETE">申请成功等待COE支付</option>
										<option value="PAID">COE支付成功</option>
										<option value="CLOSE">已关闭</option>
										</select>
									</div>
									<div id="close_remarks1" class="form-group" style="display:none;width:100%;line-height:40px;">
										<label class="control-label"><strong>备注：<span style="color:red;">(此功能接口待实现)</span></strong></label>
										<textarea id="b101" class="form-control" style="width:98%"></textarea>							
									</div>
							</div>
							</form>
					</div>
					<div class="modal-footer" style="text-align: center;">
							<dle v-if="ap_list==='GW'">									
									<dle v-if="flowstate_gw==='REVIEW'">
									<button onclick="flowstep('PENDING',1)" type="button" class="btn btn-default">撤回</button>
									</dle>
									<dle v-if="flowstate_wa==='PAID'">
									<button onclick="alert('此功能->待实现');" type="button" class="btn btn-primary">申请佣金</button>
									</dle>
							</dle>
							<dle v-if="ap_list==='WA'">									
									<dle v-if="flowstate_gw==='REVIEW' && flowstate_wa===null">											
											<button onclick="flowstep($('#c200').val(),1);" type="button" class="btn btn-primary">提交</button>											
									</dle>
									<dle v-if="flowstate_wa==='REVIEW'">
											<button onclick="flowstep('FINISH',1)" type="button" class="btn btn-primary">通过</button>
											<button onclick="flowstep('PENDING',0)" type="button" class="btn btn-default">驳回</button>
									</dle>
									<dle v-if="flowstate_wa==='FINISH' || flowstate_wa==='APPLY' || flowstate_wa==='COMPLETE' || flowstate_wa==='PAID'">
									<button onclick="alert('待实现');" id="upload_certificate1" type="button" class="btn btn-danger" style="display:none;">上传收款凭证</button>
									<button onclick="flowstep($('#c200').val(),1);" type="button" class="btn btn-primary">提交</button>
									</dle>
							</dle>							
							<button onclick="" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
</div>

</div>
<script>
var v_sub = new Vue({
				el: '#app_sub',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					m_list: localStorage.getItem("str_html"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					official_id: sessionStorage.getItem("official_id"),
					mara_id: sessionStorage.getItem("mara_id"),
					flowstate_gw: '',
					flowstate_wa: '',
					flowstate_ma: '',
				},
				created: function() {					
				}
});

function show_addnewservice_id(orderId,type)
{
		v.orderId = orderId;
		//服务详细页
		$.ajax({
      url: 'serviceOrder/get?id='+orderId,
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {			        	
    	response = response.data; 
    	if (type == 'VISA')
    	{
    			$('#show_addnewservice1_id').modal('show');
    			//签证	
        	$('#show_addnewservice1_id #b1').html(response.user.name);
        	$('#show_addnewservice1_id #b2').html(response.adviser.name);
        	$('#show_addnewservice1_id #b3').html(response.mara.name);
        	$('#show_addnewservice1_id #b4').html(response.official.name);
        	$('#show_addnewservice1_id #b6').html(response.service.code);
        	var str_ispay = '否';
        	$('#show_addnewservice1_id #show_paid').hide();
        	if (response.pay)
        	{
        			str_ispay = '是';
        			$('#show_addnewservice1_id #show_paid').show();			        	
        	}
        	$('#show_addnewservice1_id #b7').html(str_ispay);
        	$('#show_addnewservice1_id #b8').html(v.getTime(response.receiveDate));        	
        	if (response.receiveId) $('#show_addnewservice1_id #b9').html(response.receiveType.name);
        	$('#show_addnewservice1_id #b10').html(response.receivable);
        	$('#show_addnewservice1_id #b11').html(response.discount);
        	$('#show_addnewservice1_id #b12').html(response.received);
        	$('#show_addnewservice1_id #b13').html(response.paymentTimes);
        	$('#show_addnewservice1_id #b14').html(response.amount);
        	$('#show_addnewservice1_id #b15').html(response.gst);
        	$('#show_addnewservice1_id #b16').html(response.deductGst);
        	$('#show_addnewservice1_id #b17').html(response.expectAmount);
        	$('#show_addnewservice1_id #b18').html(response.remarks);
        	v_sub.flowstate_gw = response.review.adviserState;
        	v_sub.flowstate_wa = response.review.officialState;
        	v_sub.flowstate_ma = response.review.maraState;
        	if (response.review.officialState == 'REVIEW')
					{
							if (response.review.maraState == 'FINISH')
							{
									str_state = 'FINISH';//Mara已审核
									$("#b19").val('FINISH');
							}else
							{
									str_state = 'WA_REVIEW';//文案审核中...
							}
					}else if (response.review.officialState != null)
					{
							str_state = response.review.officialState;
					}
        	if (response.review.maraState == 'WAIT' || response.review.officialState == 'WAIT')
					{
							switch(v_sub.ap_list)
							{												
									case 'GW':
											str_state = 'WA_REVIEW';//文案审核中..
									break;
									case 'WA':
											str_state = 'WA_MA_WAIT';//已提交Mara审核											
									break;
									case 'MA':
											str_state = 'MA_WAIT';//待审核
									break;
							}										
					}
					if (str_state == 'WA_REVIEW' ||  str_state == 'WA_MA_WAIT' ||  str_state == 'MA_WAIT') $("#b19").val('REVIEW');
					if (str_state == 'APPLY' || str_state == 'COMPLETE' || str_state == 'CLOSE') $("#b19").val(str_state);
    	}else
    	{
    			//留学
    			$('#show_addnewservice2_id #c1').html(response.user.name);
        	$('#show_addnewservice2_id #c8').html(response.adviser.name);
        	$('#show_addnewservice2_id #c9').html(response.official.name);
        	$('#show_addnewservice2_id #c3').html(response.school.name);
        	$('#show_addnewservice2_id #c4').html(response.school.subject);
        	var str_issettle = '否';
        	if (response.settle) str_issettle = '是';
        	$('#show_addnewservice2_id #c5').html(str_issettle);
        	var str_isdeposituser = '否';
        	if (response.depositUser)
        	{
        			str_isdeposituser = '是';
        			$('#show_addnewservice2_id #show_deposit_user').show();	
        	}
        	$('#show_addnewservice2_id #c6').html(str_isdeposituser);
        	$('#show_addnewservice2_id #c7').html(response.subagency.name);
        	var str_ispay = '否';
        	if (response.pay) str_ispay = '是';
        	$('#show_addnewservice2_id #c10').html(str_ispay);
        	$('#show_addnewservice2_id #c11').html(v.getTime(response.receiveDate));
        	if (response.depositUser) $('#show_addnewservice2_id #c12').html(response.receiveType.name);
        	$('#show_addnewservice2_id #c13').html(response.receivable);
        	$('#show_addnewservice2_id #c14').html(response.discount);
        	$('#show_addnewservice2_id #c15').html(response.received);
        	$('#show_addnewservice2_id #c16').html(response.remarks);
        	v_sub.flowstate_gw = response.review.adviserState;
        	v_sub.flowstate_wa = response.review.officialState;
        	//文案操作状态
        	var str_state = '';
        	if (v_sub.flowstate_gw == 'REVIEW') $("#c200").val('PENDING');
        	if (v_sub.flowstate_wa == 'REVIEW') $("#c200").val('REVIEW');
        	if (v_sub.flowstate_wa == 'FINISH' || v_sub.flowstate_wa == 'APPLY' || v_sub.flowstate_wa == 'COMPLETE' || v_sub.flowstate_wa == 'PAID' || v_sub.flowstate_wa == 'CLOSE') $("#c200").val(v_sub.flowstate_wa);
					$('#show_addnewservice2_id').modal('show');
    	}
    });      				      		
}
</script>
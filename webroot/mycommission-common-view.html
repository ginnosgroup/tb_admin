<meta charset="utf-8"/>
<div id="app_sub">
<div class="modal fade" id="show_visa_id" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document" style="width:700px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">佣金详情页</h4>
					</div>
					<div id="alert_success" class="alert alert-success fade in" style="display:none;position:absolute;z-index:9999;">
			      <button data-dismiss="alert" class="close close-sm" type="button">
			      <i class="fa fa-times"></i>
			      </button>
			      <strong>Success!</strong> You  just achieved success.
			  	</div>
			  	<div id="alert_error" class="alert alert-block alert-danger fade in" style="display:none;position:absolute;z-index:9999;">
		        <button data-dismiss="alert" class="close close-sm" type="button">
		        <i class="fa fa-times"></i>
		        </button>
		        <strong id="error_info"></strong>
		      </div>
					<div class="modal-body">
							<form class="form-inline" style="">																											
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>服务订单Id：</strong></label>								
								<label id="b0"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>客户姓名：</strong></label>								
								<label id="b1"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>顾问：</strong></label>
								<label id="b2" style="width:100px;"></label>
								<label class="control-label"><strong>Mara：</label>
								<label id="b3" style="width:100px;"></label>
								<label class="control-label"><strong>文案：</label>
								<label id="b4" style="width:100px;"></label>
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>服务项目：</strong></label>
								<label id="b5">签证</label> - 
								<label id="b6"></label>						
							</div>
							<div class="form-group" style="width:100%;height:40px;">
								<label class="control-label" style="width:80px;"><strong>是否已支付：</strong></label>
								<label id="b7"></label>
							</div>
							<div id="show_paid" style="width:100%;">
							<hr/>
							<div class="form-group" style="width:100%;">								
									<label class="control-label" style="width:80px;"><strong>收款日期：</strong></label>
									<label id="b8" style="width:100px;"></label>
									<label class="control-label"><strong>收款方式：</strong></label>
									<label id="b9" style="width:150px;"></label>
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
									<div class="form-group">
										<label class="control-label" style="width:80px;"><strong>总计应收：</strong></label>
										$<label id="b10" style="width:80px;"></label>
									</div>									
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>总计收款：</strong></label>
										$<label id="b12" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>付款次数：</strong></label>
										<label id="b13"></label>
									</div>
							</div>
							<div class="form-group" style="display:block;line-height:40px;">
									<div class="form-group" style="">
										<label class="control-label"><strong>本次应收：</strong></label>
										$<label id="b14a" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>折扣：</strong></label>
										$<label id="b11" style="width:80px;"></label>
									</div>
									<div class="form-group">
										<label class="control-label" style="width:80px;"><strong>本次收款：</strong></label>
										$<label id="b14" style="width:80px;"></label>
									</div>
									<div class="form-group" style="margin-left:10px;">
										<label class="control-label"><strong>GST：</strong></label>
										$<label id="b15" style="width:80px;"></label>
									</div>
									<div class="form-group" style="">
										<label class="control-label"><strong>Deduct GST：</strong></label>
										$<label id="b16" style="width:65px;"></label>
									</div>
									<div class="form-group" style="">
										<label class="control-label"><strong>预收业绩(<span style="color:#FF6C60;">Commission含GST</span>)：</strong></label>
										$<label id="b17" style="width:50px;"></label>
									</div>
							</div>
							</div>
							<div id="show_paymentpic" class="form-group" style="display:;width:100%;line-height:40px;">
								<label class="control-label"><strong>收款凭证：</strong></label>
								<label id="paymentpic_url"></label>
							</div>
							<div id="show_visapic" class="form-group" style="display:;width:100%;line-height:40px;">
								<label class="control-label"><strong>签证凭证：</strong></label>
								<label id="visapic_url"></label>
							</div>
							<hr/>
							<div class="form-group" style="width:100%;line-height:40px;">
								<label class="control-label"><strong>备注：</strong></label>
								<label id="b18"></label>
							</div>														
							</form>
					</div>
					<div class="modal-footer" style="text-align: center;">
							<dle v-if="ap_list==='GW'">									
									<dle v-if="state==='PENDING'">
									<button onclick="$('#show_visa_id').modal('hide');reqCommissionVisa(v_sub.serviceId,v_sub.orderId);" type="button" class="btn btn-primary">申请月奖</button>
									</dle>
							</dle>													
							<button onclick="" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
</div>
</div>

<script>
var v_sub = new Vue({
				el: '#app_sub',
				data: {
					admin: sessionStorage.getItem("admin"),
					ap_list: sessionStorage.getItem("ap_list"),
					m_list: localStorage.getItem("str_html"),
					adviser_id: sessionStorage.getItem("adviser_id"),
					official_id: sessionStorage.getItem("official_id"),
					serviceId: 0,
					orderId: 0,
					state: '',
					order_detail: [],					
				},
				created: function() {					
				}
});

function show_commission_detail(serviceId,orderId)
{
		v_sub.serviceId = serviceId
		v_sub.orderId = orderId;		
		//佣金详细页
		$.ajax({
      url: 'serviceOrder/get?id='+serviceId,
      type: 'GET',
      dataType: 'json'
    }).done(function(response) {			        	
    	response = response.data;
    	if (response.id)
    	{
		    	$('#show_visa_id').modal('show');
		    	$('#show_visa_id #b0').html(response.id);
		    	$('#show_visa_id #b1').html(response.user.name);
		    	$('#show_visa_id #b2').html(response.adviser.name);
		    	$('#show_visa_id #b3').html(response.mara.name);
		    	$('#show_visa_id #b4').html(response.official.name);
		    	$('#show_visa_id #b6').html(response.service.code);
        	$('#show_visa_id #b7').html('是'); 
        	$('#show_visa_id #show_paid').show();
    	}  	
    	//查询佣金订单信息
    	$.ajax({
	      url: 'visa/get?id='+orderId,
	      type: 'GET',
	      dataType: 'json'
	    }).done(function(response) {			        	
	    	response = response.data;
	    	v_sub.order_detail = response;
	    	v_sub.state = response.state;
	    	if (response.id)
	    	{	    			
				    $('#show_visa_id #b8').html(v.getTime(response.receiveDate));        	
	        	if (response.receiveTypeId) $('#show_visa_id #b9').html(response.receiveTypeName);
	        	$('#show_visa_id #b10').html(response.receivable);
	        	$('#show_visa_id #b11').html(response.discount);
	        	$('#show_visa_id #b12').html(response.received);
	        	$('#show_visa_id #b13').html(response.installmentNum+'/'+response.installment);
	        	$('#show_visa_id #b14').html(response.amount);
	        	$('#show_visa_id #b14a').html(response.perAmount);
	        	$('#show_visa_id #b15').html(response.gst);
	        	$('#show_visa_id #b16').html(response.deductGst);
	        	$('#show_visa_id #b17').html(response.expectAmount);
	        	$('#show_visa_id #b18').html(response.remarks);
	        	//生成收款凭证列表
						var str_flist = '';
						$("#show_visa_id #paymentpic_url").empty();
						if (response.paymentVoucherImageUrl1)
						{
								str_flist = response.paymentVoucherImageUrl1;
								$("#show_visa_id #paymentpic_url").append('<a href="/statics'+response.paymentVoucherImageUrl1+'" target="_blank">查看凭证1</a>&nbsp;');
						}
						if (response.paymentVoucherImageUrl2)
						{
								str_flist += ','+response.paymentVoucherImageUrl2;
								$("#show_visa_id #paymentpic_url").append('<a href="/statics'+response.paymentVoucherImageUrl2+'" target="_blank">查看凭证2</a>&nbsp;');
						}
						//生成签证凭证
						if (response.visaVoucherImageUrl)
						{
								str_flist = response.visaVoucherImageUrl;
								$("#show_visa_id #visapic_url").append('<a href="/statics'+response.visaVoucherImageUrl+'" target="_blank">查看凭证</a>&nbsp;');
						}
						$('#show_visa_id #show_visapic').show();					
	    	}
    	});
    	
    });
}
</script>